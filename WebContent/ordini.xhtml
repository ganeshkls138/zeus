<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">
<h:head>
 <title>Zeus - Visualizza ordini</title>
 <link rel="shortcut icon" type="image/x-icon" href="#{request.contextPath}/images/favicon.ico"/>
 <link href="css/zeus.css" rel="stylesheet" type="text/css" />

</h:head>
<h:body>
 		<div class="divNorth">
	    	<ui:include page="menubar.xhtml" />
	    </div>
	
		<div class="divCenter">	
			
			<h:form id="form" style="margin-top:50px"  >
			
			<p:growl id="growl" showDetail="true" sticky="false" life="2000"/>  
			
				<div style="margin-bottom: 40px; height:55px;">
					<div style="float:left">
						<div>
							Mostra ordini da <p:calendar value="#{ordineBean.mostraDa}" id="mostradatada" locale="it" size="9" pattern="dd/MM/yyyy" maxdate="#{ordineBean.dataOggi}"/> 
											a <p:calendar value="#{ordineBean.mostraA}" id="mostradataa" locale="it" size="9" pattern="dd/MM/yyyy" maxdate="#{ordineBean.dataOggi}"/>  
							&nbsp; 
							Filtra per <p:selectOneMenu style="width:120px" value="#{ordineBean.filtroOrdini}"> 		
												<f:selectItem itemLabel="Tutti" itemValue="tutti" /> 
												<f:selectItem itemLabel="Pagati" itemValue="pagati" />
												<f:selectItem itemLabel="Non pagati" itemValue="nonpagati" /> 		
								      		    <f:selectItem itemLabel="Spediti" itemValue="spediti" />
								      		    <f:selectItem itemLabel="Archiviati" itemValue="archiviati" />
								     		 </p:selectOneMenu>			
							&nbsp; 	
							<p:commandButton value="Mostra" id="showButton" action="#{ordineBean.reloadOrdini}" update="tabellaOrdini growl"/>
						</div>
						<br/>
						<div>
							Scarica ordini da <p:calendar value="#{ordineBean.scaricaDa}" id="scaricadatada" locale="it" size="9" pattern="dd/MM/yyyy" maxdate="#{ordineBean.dataOggi}"/> 
											a <p:calendar value="#{ordineBean.scaricaA}" id="scaricadataa" locale="it" size="9" pattern="dd/MM/yyyy" maxdate="#{ordineBean.dataOggi}"/>  
							&nbsp; <p:commandButton value="Scarica" id="downloadButton" action="#{ordineBean.downloadOrdini}" update="tabellaOrdini growl"/>
						</div>
					</div>
					
					<div style="float:right">
					    <p:commandButton value="Coda LDV" id="vediCodaLDV" update=":panelLDV" action="#{ordineBean.aggiornaOrdiniPerLDV()}" oncomplete="ldvDialog.show()" />
						&nbsp; <p:commandButton value="Aggiorna ordini" id="reloadOrd" action="#{ordineBean.reloadOrdini}" update="form"/>
						&nbsp; <p:commandButton value="Aggiorna mappa articoli" id="reloadMap" action="#{ordineBean.reloadMappaArticoli}" update="form"/>
					</div>
				</div>
				
				<p:dataTable var="ord" value="#{ordineBean.ordini}" filterEvent="enter" filterDelay="0"
					rowKey="#{ord.idOrdine}" paginator="true" rows="50" 
					paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"  
					currentPageReportTemplate="Mostrati {totalRecords} ordini in {totalPages} pagine"
					emptyMessage="Nessun ordine trovato per il periodo selezionato."
					rowsPerPageTemplate="10,25,50,100" sortBy="#{ord.dataAcquisto}" sortOrder="descending"
					selection="#{ordineBean.ordineSelezionato}" selectionMode="single"
					filteredValue="#{ordineBean.ordiniFiltrati}" id="tabellaOrdini">

					<p:ajax event="rowSelect" update=":panelDettaglioOrdine :form:growl" oncomplete="ordDialog.show()" />

			        <p:column headerText="ID" width="100" sortBy="#{ord.idOrdine}" filterBy="#{ord.idOrdine}" filterStyle="width:70%" style="text-align:center">
			        	##{ord.idOrdine}
			        </p:column>
			        
			        <p:column headerText="ID Piattaforma" width="100" sortBy="#{ord.idOrdinePiattaforma}" filterMatchMode="contains"
			         filterBy="#{ord.idOrdinePiattaforma}" filterStyle="width:70%" style="text-align:center">
			        	#{ord.idOrdinePiattaforma}
			        </p:column>
			        
			        <p:column headerText="Stato" sortBy="#{ord.stato}" filterMatchMode="contains"
									filterBy="#{ord.stato}" id="stato" filterStyle="width:60%">
			            #{ord.stato}
			        </p:column>
			        
			        <p:column headerText="Data Acquisto" sortBy="#{ord.stDataAcquisto}" filterMatchMode="contains" width="100"
									filterBy="#{ord.stDataAcquisto}" id="data" filterStyle="width:85%" style="text-align:center">
			            #{ord.stDataAcquisto}
			        </p:column>	
			        
			        <p:column headerText="Acquirente" sortBy="#{ord.cliente.nomeCompleto}" filterMatchMode="contains"
									filterBy="#{ord.cliente.nomeCompleto} (#{ord.cliente.username})" id="nomeAcquirente" filterStyle="width:70%">
			            #{ord.cliente.nomeCompleto} <h:outputText value="(#{ord.cliente.username})" style="color:darkblue" rendered="#{ord.piattaforma.equals('eBay')}"/>
			        </p:column>	
			        
			       <p:column headerText="Piattaforma" sortBy="#{ord.piattaforma}" filterMatchMode="contains"
									filterBy="#{ord.piattaforma}" id="piattaforma" filterStyle="width:70%" >
			            #{ord.piattaforma}
			        </p:column>
			
			        <p:column headerText="Pagamento" sortBy="#{ord.metodoPagamento}" filterStyle="width:70%" filterMatchMode="contains"
									filterBy="#{ord.metodoPagamento}" id="metodoPagamento">
			            #{ord.metodoPagamento}
			        </p:column> 
			        
			        <p:column headerText="Totale" sortBy="#{ord.totale}" filterMatchMode="contains" width="66"
									filterBy="#{ord.totale} #{ord.valuta}" id="totale" filterStyle="width:60%">
			            <h:outputText value="#{ord.totale} #{ord.valuta}" style="float:right"/>
			        </p:column>
			        
			        <p:column style="width:4%;text-align:center" headerText="LDV" rendered="#{ordineBean.noButton()}">  
		                <p:commandButton id="inviaAcodaLDV" update=":formLDV :form:growl" action="#{ordineBean.inviaAcodaLDV}" 
		                							icon="ui-icon-arrowrefresh-1-n" title="Invia alla coda LDV">  
			                <f:setPropertyActionListener value="#{ord}" target="#{ordineBean.ordineSelezionato}" />  
			            </p:commandButton>  
			        </p:column>  
			        
			        <p:column style="width:4%;text-align:center" headerText="Scontrino" rendered="#{ordineBean.noButton()}">  
		                <p:commandButton id="printScontrinoButton" update=":form:tabellaOrdini :form:growl" action="#{ordineBean.stampaScontrino}" icon="ui-icon-print" title="Stampa lo scontrino">  
			                <f:setPropertyActionListener value="#{ord}" target="#{ordineBean.ordineSelezionato}" />  
			            </p:commandButton>  
			        </p:column>  
			        
			        <p:column style="width:4%;text-align:center" headerText="Archivia" rendered="#{ordineBean.noButton()}">  
		                <p:commandButton id="archivia" update=":form:tabellaOrdini :form:growl" action="#{ordineBean.archivia}" 
		                							icon="ui-icon-circle-check" title="Archivia questo ordine">  
			                <f:setPropertyActionListener value="#{ord}" target="#{ordineBean.ordineSelezionato}" />  
			            </p:commandButton>  
			        </p:column>  
			        
			     </p:dataTable>
					     
				
				

				<p:blockUI block="form" trigger="showButton" >  
			        Download in corso...<br />  
			        <p:graphicImage value="images/ajax-loader.gif"/>  
			    </p:blockUI> 
			     
			     <p:blockUI block="form" trigger="downloadButton" >  
			        Download in corso...<br />  
			        <p:graphicImage value="images/ajax-loader.gif"/>  
			    </p:blockUI>  
			    
			    <p:blockUI block="form" trigger="reloadMap" >  
			        Operazione in corso...<br />  
			        <p:graphicImage value="images/ajax-loader.gif"/>  
			    </p:blockUI>  
			    
			    <p:blockUI block="form" trigger="reloadOrd" >  
			        Operazione in corso...<br />  
			        <p:graphicImage value="images/ajax-loader.gif"/>  
			    </p:blockUI>  
			    
			     <p:blockUI block="tabellaOrdini" trigger="tabellaOrdini" >  
			        Operazione in corso...<br />  
			        <p:graphicImage value="images/ajax-loader.gif"/>  
			    </p:blockUI>  
			    
			</h:form>
		
			<ui:include page="pages/ordini/dettaglio_ordine.xhtml" />
				
			<ui:include page="pages/ordini/coda_ldv.xhtml" />
				
			<ui:include page="pages/ordini/dettaglio_articolo.xhtml" />
			
			<p:dialog header="Operazione in corso..." widgetVar="wait_dialog" showEffect="fade"
					hideEffect="fade" width="200" resizable="false">					
				<p:graphicImage  style="align:center" value="images/loading.gif"/>
			</p:dialog>	

		</div>
                        
</h:body>
</html>
